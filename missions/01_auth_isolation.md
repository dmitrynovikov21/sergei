MISSION 01: AUDIT AUTH & DATA ISOLATION SETUP
üéØ –¶–ï–õ–¨
–ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ NextAuth (Google Provider).

–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å.

–ì–õ–ê–í–ù–û–ï: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–±—Ä–æ—Å userId –≤ —Å–µ—Å—Å–∏—é, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö.

–°–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª—é—á–µ–π Google Cloud.

üìÇ –ö–û–ù–¢–ï–ö–°–¢
–í –ø—Ä–æ–µ–∫—Ç–µ –£–ñ–ï –µ—Å—Ç—å —Ñ–∞–π–ª—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (auth.ts, auth.config.ts –∏ —Ç.–¥.). –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–π –∏—Ö –±–µ–∑–¥—É–º–Ω–æ! –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—á–∏—Ç–∞–π –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π.

üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô (STEP-BY-STEP)
–®–ê–ì 1: –ê—É–¥–∏—Ç —Å—Ö–µ–º—ã –ë–î (Prisma)
–ü—Ä–æ—á–∏—Ç–∞–π prisma/schema.prisma.

–£–±–µ–¥–∏—Å—å, —á—Ç–æ –º–æ–¥–µ–ª–∏ User, Account, Session –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è NextAuth Adapter.

CRITICAL: –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ —Å–≤—è–∑—å User —Å –¥—Ä—É–≥–∏–º–∏ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç—è–º–∏ (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å).

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –õ—é–±–∞—è —Å—É—â–Ω–æ—Å—Ç—å, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∞—è —é–∑–µ—Ä—É (–ø—Ä–æ–µ–∫—Ç, –¥–æ–∫—É–º–µ–Ω—Ç, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è), –û–ë–Ø–ó–ê–ù–ê –∏–º–µ—Ç—å –ø–æ–ª–µ userId.

–®–ê–ì 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NextAuth (Data Isolation Logic)
–ü—Ä–æ—á–∏—Ç–∞–π auth.config.ts –∏ auth.ts.

Callback Logic: –ù–∞–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤–µ–∑–¥–µ.

–ü—Ä–æ–≤–µ—Ä—å callbacks.jwt: –¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å user.id.

–ü—Ä–æ–≤–µ—Ä—å callbacks.session: –°–µ—Å—Å–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∞—Ç—å user.id –∏–∑ —Ç–æ–∫–µ–Ω–∞.

–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ: –ï—Å–ª–∏ –≤ —Å–µ—Å—Å–∏–∏ –Ω–µ—Ç ID, –º—ã –Ω–µ —Å–º–æ–∂–µ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î => –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏.

–ï—Å–ª–∏ –∫–æ–ª–±—ç–∫–æ–≤ –Ω–µ—Ç –∏–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ–∫–∏–¥—ã–≤–∞—é—Ç ID ‚Äî –¥–æ–ø–∏—à–∏ –∏—Ö.

–®–ê–ì 3: Environment Variables & Google Console Guide
–ü—Ä–æ–≤–µ—Ä—å, –∫–∞–∫ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –∫–æ–¥–µ (–æ–±—ã—á–Ω–æ AUTH_GOOGLE_ID, AUTH_GOOGLE_SECRET).

–ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞–π —Ñ–∞–π–ª docs/GOOGLE_AUTH_SETUP.md.

–ù–∞–ø–∏—à–∏ –≤ –Ω–µ–º –ø–æ—à–∞–≥–æ–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –º–µ–Ω—è (—á–µ–ª–æ–≤–µ–∫–∞):

–ö—É–¥–∞ –∑–∞–π—Ç–∏ –≤ Google Cloud Console.

–ö–∞–∫–æ–π —Ç–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞—Ç—å.

–ö–∞–∫–∏–µ "Authorized redirect URIs" –ø—Ä–æ–ø–∏—Å–∞—Ç—å (–¥–ª—è –ª–æ–∫–∞–ª–∫–∏ —ç—Ç–æ –æ–±—ã—á–Ω–æ http://localhost:3000/api/auth/callback/google).

–ì–¥–µ –≤–∑—è—Ç—å –∫–ª—é—á–∏.

–®–ê–ì 4: Middleware & Protection
–ü—Ä–æ–≤–µ—Ä—å middleware.ts.

–£–±–µ–¥–∏—Å—å, —á—Ç–æ –æ–Ω –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–º —Ä–æ—É—Ç–∞–º (Dashboard, API).

–ü—É–±–ª–∏—á–Ω—ã–µ —Ä–æ—É—Ç—ã (Landing, Login) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã.

üß† –ü–ê–¢–¢–ï–†–ù –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò (SOLIS/DRY)
–¢—ã –¥–æ–ª–∂–µ–Ω –≤–Ω–µ–¥—Ä–∏—Ç—å (–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ) –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "Safe Query". –í –±—É–¥—É—â–µ–º, –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

TypeScript

// –ü–†–ê–í–ò–õ–¨–ù–û (–ò–∑–æ–ª—è—Ü–∏—è —Å–æ–±–ª—é–¥–µ–Ω–∞)
db.document.findMany({
  where: {
    userId: session.user.id // <-- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
  }
})

// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
db.document.findMany() 
–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–µ–∫—É—â–∏–π –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω (—Ç.–µ. session.user.id —Å—É—â–µ—Å—Ç–≤—É–µ—Ç).

üö¶ –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò (DOD)
–ö–æ–¥ auth.ts / auth.config.ts –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.

–í –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ (console.log(session)) –≤–∏–¥–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã.

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª docs/GOOGLE_AUTH_SETUP.md —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π.

–ü—Ä–æ–µ–∫—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤ TypeScript –Ω–µ—Ç.